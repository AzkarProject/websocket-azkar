<html>

<head>
</head>

<head>
    <meta charset="utf-8" />
    <meta name='keywords' content='WebRTC, HTML5, JavaScript' />
    <meta name='description' content='WebRTC benchmarks base for AZKAR project' />
    <!-- viewport sert a controler la mise en page sur les appareils mobiles -->
    <meta name='viewport' content='width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1'>
    <link rel="stylesheet" href="/css/style.css" />
    <title>WebRTC AZKAR</title>
</head>

<body class="ihmPilote">
    <strong><span id="zone_info_server">WebRTC AZKAR</span></strong>
    <hr/>
    <!-- <ul class="flex-container wrap"> -->
    <section id="settingsArea" class="fullSizeContainerBox">
        <div id="top" class="insideFlex pilote shadowBlack floatLeft fourQuarterBox">
            <strong> Benchmarks Settings </strong>
            <hr/>
            <span id="localVideoSetting" class="">
                            Pilote Camera view: 
                            <input type="radio" name="lVidSetting" value="hide" id="lVhide" onclick="setPilotVideo('hide')"/> <label for="rVhide">Hide local Video</label>
                            <input type="radio" name="lVidSetting" value="show" id="lVshow" checked/ onclick="setPilotVideo('show')"> <label for="lVshow">Show local Video</label>
                        </span>
            <br/>
            <span id="remoteVideoSetting" class="">
                            Robot Camera view: 
                            <input type="radio" name="rVidSetting" value="hide" id="rVhide" onclick="setRobotVideo('hide')"/> <label for="rVhide">Hide remote Video</label>
                            <input type="radio" name="rVidSetting" value="low" id="rVlow" onclick="setRobotVideo('low')"/> <label for="rVlow">Show in low Resolution</label>
                            <input type="radio" name="rVidSetting" value="medium" id="rVmedium" onclick="setRobotVideo('medium')" /> <label for="rVmedium">Show in medium Resolution</label>
                            <input type="radio" name="rVidSetting" value="high" id="rVhigh" onclick="setRobotVideo('high')" checked/> <label for="rVhigh">Show in High resolution</label>   
                        </span>
            <br/>
            <span id="streamSetting" class="">
                            Stream local pilote video to robot: 
                            <input type="radio" name="streamVidToRobot" value="open" id="streamOpen" onclick="setPilotStream('open')" checked /> <label for="streamOpen">Yes</label>
                            <input type="radio" name="streamVidToRobot" value="close" id="streamClose" onclick="setPilotStream('close')" /> <label for="streamClose">No</label>
                        </span>
            <br/>
            <span id="dataChannelSetting" class="">
                            Select controls and navigation data channel: 
                            <input type="radio" name="controlChannel" value="webSocket" id="webSocket" onclick="setCtrlChannel('webSocket')" checked /> <label for="webSocket">webSocket</label>
                            <input type="radio" name="controlChannel" value="webRTC" id="webRTC" onclick="setCtrlChannel('webRTC')"/> <label for="webRTC">webRTC</label>
                        </span>
        </div>
    </section>
    <section id="controlArea" class="fullSizeContainerBox">
        <!--<li class="flex-item">-->
        <div id="colGaucheHaut" class="floatLeft oneQuarterContainerBox">
            <div id="robotDevices" class="insideFlex oneQuarterbox robot shadowBlack device">
                <strong>Robot Devices</strong>
                <hr/>
                <div class="select">
                    <label for="remote_audioSource">Audio: </label>
                    <select id="remote_audioSource"></select>
                </div>
                <div class="select">
                    <label for="remote_videoSource">Video: </label>
                    <select id="remote_videoSource"></select>
                </div>
                <hr/>
                <button id="remote_ButtonDevices" onclick="remoteManageDevices()">Sélectionner</button>
            </div>
            <div id="piloteDevices" class="insideFlex oneQuarterbox pilote shadowBlack device">
                <strong> Pilote Devices</strong>
                <hr/>
                <video id='video' autoplay muted controls="controls"></video>
                <hr/>
                <div class="select">
                    <label for="local_audioSource">Audio: </label>
                    <select id="local_audioSource"></select>
                </div>
                <div class="select">
                    <label for="local_videoSource">Video: </label>
                    <select id="local_videoSource"></select>
                </div>
                <hr/>
                <button class="shadowBlack" id="local_ButtonDevices" onclick="localManageDevices()">Ouvrir la connexion</button>
            </div>
            <div id="robotCommands" class="insideFlex oneQuarterbox robot shadowBlack device">
                <strong>Robot controls</strong> <span id="connect-notice"> --- Gamepad non détecté</span>
                <hr/>
                <div id="disconnected-gamepad">
                    <div id="divBtUp">
                        <button id="btnUp" class="btnCommandsPad" onclick="cmdUp()">&uarr;</button>
                    </div>
                    <div id="divBtLeft">
                        <button id="btnLeft" class="btnCommandsPad" onclick="cmdLeft()">&larr;</button>
                    </div>
                    <div id="divBtRight">
                        <button id="btnRight" class="btnCommandsPad" onclick="cmdRight()">&rarr;</button>
                    </div>
                    <div id="divBtDown">
                        <button id="btnDown" class="btnCommandsPad" onclick="cmdDown()">&darr;</button>
                    </div>
                    <div id="divBtSpeed">
                        <!--
                                <button id="btnIncrease" class="btnCommandsPad" onclick="cmdIncrease()">+</button>
                                alert(" enable  : " + enable   + " | targetLinearSpeedPos  : " +  targetLinearSpeedPos + " | targetLinearSpeedNeg :" targetLinearSpeedNeg + " | targetAngularSpeed : " + targetAngularSpeed );
                                <button id="btnDecrease" class="btnCommandsPad" onclick="cmdDecrease()">-</button>
                                -->
                        <button id="btnIncrease" class="btnCommandsPad" onclick="cmdSpeed(-0.1)">-</button>
                        <progress id="jaugeSpeedSetting" value="0.5" max="1"></progress>
                        <button id="btnDecrease" class="btnCommandsPad" onclick="cmdSpeed(0.1)">+</button>
                        <br/> Speed Setting: <span id="speedSetting">m.s</span>
                        <script>
                        function jaugeSpeedSetting() {
                            var ava = document.getElementById("jaugeSpeedSetting");
                            var prc = document.getElementById("speedSetting");
                            prc.innerHTML = ava.value + " m.s";
                        }

                        jaugeSpeedSetting();

                        function cmdSpeed(val) {
                            var ava = document.getElementById("jaugeSpeedSetting");
                            if ((ava.value + val) <= ava.max && (ava.value + val) >= 0) {
                                ava.value += val;
                            }
                            jaugeSpeedSetting();
                        }
                        </script>
                    </div>
                </div>
                <div id="connected-GamePad">
                    <ul id="gamepads"></ul>
                    <div id="divBtUp">
                        <button id="btnGpTourne" class="btnCommandsPad" onclick="cmdGpTourne()">Tourne</button>
                    </div>
                    <div id="divBtLeft">
                        <button id="btnGpStop" class="btnCommandsPad" onclick="cmdgpStop()">Stop</button>
                    </div>
                    <div id="divBtRight">
                        <button id="btnGpAlert" class="btnCommandsPad" onclick="cmdGpAlert()">Info</button>
                    </div>
                    <script>
                    function cmdGpTourne() {
                        // Todo
                    }

                    function cmdGpStop() {
                        //todo
                    }

                    function cmdGpAlert() {
                        alert(enable)
                    }
                    </script>
                </div>
            </div>
        </div>
        <div id="colDroiteHaut" class="floatRight tripleQuarterBox">
            <div id="remoteVideoArea" class="insideFlex robot tripleQuarterBox shadowBlack floatRight">
                <strong> Robot Camera View</strong>
                <hr/>
                <video id='otherPeer' class="" autoplay muted controls="controls"></video>
            </div>
        </div>
        <div id="colDroiteMiddle" class="floatLeft oneThirdContainerBox">
            <div id="robotInfos" class="insideFlex pilote oneThirdBox shadowBlack device floatLeft">
                <strong> Robot Informations</strong>
                <hr/>
                <div class="jauge">
                    <label for="battery_level">Battery Level:</label>
                    <progress id="battery_level" class="floatRight" max=100><span>0</span>%</progress>
                </div>
                <div class="jauge">
                    <label for="speed_robot">Real Speed:</label>
                    <progress id="speed_robot" class="floatRight" value="50" max="100"></progress>
                </div>
            </div>
            <div id="websocketChat" class="insideFlex pilote oneThirdBox shadowBlack floatLeft">
                <strong> Websocket Messages & Chat</strong>
                <hr/>
                <form action="/" method="post" id="formulaire_chat_websoket">
                    <input type="text" name="message" id="message" placeholder="Votre message..." size="28" autofocus />
                    <!--<input type="submit" id="envoi_message" value="Envoyer" />-->
                    <button id="envoi_message" type="submit">Envoyer</button>
                </form>
                <div id="zone_chat_websocket"></div>
                <div id="zone_reception_commande_websocket"></div>
            </div>
        </div>
        <div id="colgaucheMiddle" class="floatRight doubleThirdContainerBox">
            <div id="remoteCanvasArea" class="insideFlex robot DoubleThirdBox shadowBlack floatRight">
                <strong> Navigation</strong>
                <hr/>
                <canvas id="mapviewer_canvas" width="620" height="350" class="floatright">
                    Votre navigateur ne supporte pas les canvas.
                </canvas>
                <div id="points_interets_area" class="floatLeft">
                    <form action="/" method="post" id="formulaire_points_interets">
                        <p>
                            <input type="radio" name="goto" value="x,y" id="salon" />
                            <label for="salon">Salon</label>
                            <br />
                            <input type="radio" name="goto" value="x,y" id="cuisine" />
                            <label for="cuisine">Cuisine</label>
                            <br />
                            <input type="radio" name="goto" value="x,y" id="chambre" />
                            <label for="chambre">Chambre</label>
                            <br />
                            <input type="radio" name="goto" value="x,y" id="sdb" />
                            <label for="sdb">Salle de bain</label>
                            <br />
                            <input type="radio" name="goto" value="x,y" id="entree" />
                            <label for="entree">Entrée</label>
                            <br />
                            <button id="envoi_goto" type="submit">Go</button>
                        </p>
                    </form>
                </div>
            </div>
        </div>
        <div id="bottom" class="floatRight fullSizeContainerBox">
            <div id="dataChannelArea" class="insideFlex pilote shadowBlack floatLeft fourQuarterBox">
                <strong> WebRTC dataChannel Log </strong>
                <hr/>
                <div id="formulaire_chat_webRTC" class="pseudoForm">
                    <input type="text" name="message" id="send_chat_WebRTC" placeholder="Waiting open channel..." size="28" autofocus />
                    <button id="sendButton" disabled onclick="sendMessage()">Envoyer</button>
                </div>
                <br/>
                <div id="zone_chat_WebRTC"></div>
            </div>
        </div>
    </section>
    <ul id="gamepads"></ul>
    <!--
    <p id="connect-notice">toto connecte ta mannette stp :) !!</p>
    -->
    <script>
    var type = "pilote-appelant";
    var otherType = "pilote-appelé";
    </script>
    <script src="/js/lib/jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src='/js/lib/adapter.js'></script>
    <script src="/js/lib/gamepad.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/settings.js"></script>
    <script src='/js/mapviewer.js'></script>
    <script src='/js/ws_manager.js'></script>
    <script src='/js/commands.js'></script>
    <script src='/js/main.js'></script>
    <script>
    $('#zone_info_server').replaceWith(settings.appName() + " V " + settings.appVersion() + " - IHM Pilote");
    </script>
    <script src="/js/lib/xml2json.js"></script>
    <script>
    /**
     * function qui permet de recupérer le niveau de la  la battery et de l'afficher dans le progress bar
     * elle interroge chaque 1000ms le robot via url et retourne le niveau de la battery en pourcentage
     */

    $(document).ready(function() {

        refreshBattery = function() {
            var url = "http://192.168.173.1:8080/?url=http://127.0.0.1:50000/robulab/battery/battery"; // url est passé en paramètre , elle sera interpretée par le proxy en premier
            var delay = 1000; // l'interval de temps au bout du quel on envoi une autre requete pour rafraichir les information

            setInterval(function() {
                $.get(url, function(data) {
                    console.log('dataBatery xml-----> ', data);

                    var xml = $.parseXML(data),
                        $xml = $(xml),
                        $test = $xml.find('Remaining');

                    console.log($test.text());
                    var remaining = $test.text();
                    // console.log('remaining  -----> ', remaining);
                    var percentage = (remaining <= 100) ? remaining : 100;
                });
            }, delay);

            return percentage;
        }

        var progressBar = document.getElementById('battery_level');
        var newValue = refreshBattery();

        function updateProgress(newValue) {
            progressBar.value = newValue;
            progressBar.getElementsByTagName('span')[0].textContent = newValue;
        }



    });
    </script>
</body>

</html>
